# Copilot Instructions for nanoleaf-local

## Project Overview

This repository is focused on bypassing the Matter protocol on Nanoleaf downlights and using CoAP (Constrained Application Protocol) over Thread instead. The goal is to provide local control of Nanoleaf devices without relying on cloud services or the Matter protocol.

## Key Technologies

- **CoAP (Constrained Application Protocol)**: A specialized web transfer protocol for use with constrained nodes and networks
- **Thread**: A low-power mesh networking protocol for IoT devices
- **Nanoleaf Downlights**: Smart lighting devices that typically use Matter protocol

## Development Guidelines

### Code Style and Standards

- Write clear, maintainable code with appropriate comments for complex logic
- Follow the existing code structure and naming conventions in the repository
- Keep functions focused and modular
- Document any protocol-specific details or hardware interactions

### Testing

- Write unit tests for new functionality when test infrastructure exists
- Test IoT device interactions thoroughly, considering edge cases like:
  - Network disconnections
  - Device timeout scenarios
  - Concurrent requests
  - Protocol state management
- Verify changes don't break existing device communication patterns

### Documentation

- Update README.md when adding new features or changing setup instructions
- Document any CoAP message formats or Thread networking specifics
- Include examples for common use cases
- Note any hardware-specific requirements or limitations

### Best Practices for IoT/Network Code

- Handle network timeouts gracefully
- Implement proper error handling for device communication failures
- Consider power consumption implications of protocol choices
- Validate message formats before sending to devices
- Log important protocol interactions for debugging

### Security Considerations

- Never commit device credentials, API keys, or network security keys
- Validate all input from external sources (devices, network messages)
- Be cautious with device firmware interactions
- Document any security assumptions or requirements

## Common Tasks

### Adding New CoAP Features

When implementing new CoAP message types or handlers:
1. Document the message format and expected responses
2. Add error handling for malformed messages
3. Test with actual Nanoleaf hardware if possible
4. Update documentation with the new capability

### Protocol Debugging

- Add detailed logging for protocol messages during development
- Consider packet capture tools for Thread network analysis
- Document any non-standard protocol behaviors discovered

## Issue and PR Guidelines

- For bug reports, include device model, network setup, and reproduction steps
- For feature requests, explain the use case and expected behavior
- Keep changes focused and scoped to the specific issue
- Test with real hardware when possible before submitting PRs

## Getting Started

For new contributors or when setting up the development environment:
1. Clone the repository
2. Review the README.md for setup instructions
3. Ensure you have access to Nanoleaf downlight hardware for testing
4. Familiarize yourself with CoAP and Thread networking basics

## Additional Notes

- This project involves low-level protocol work with IoT devices
- Changes should be tested carefully to avoid bricking devices
- When in doubt, start with read-only operations before implementing write functionality
- Document any discoveries about the Nanoleaf protocol implementation
